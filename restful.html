

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Significative “RESTful” URLs &mdash; Nagare 0.4.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Nagare 0.4.1 documentation" href="index.html"/>
        <link rel="next" title="The WSGI Application" href="wsgiapp.html"/>
        <link rel="prev" title="The Renderer objects" href="renderer.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="description.html">Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">Using it</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">QuickStart</a></li>
<li class="toctree-l1"><a class="reference internal" href="framework_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="framework_upgrade.html">Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="nagare-admin.html">nagare-admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_file.html">Application configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="publisher_file.html">Publisher configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Application deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="third_party.html">Third party applications</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial1.html">Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial2.html">Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial3.html">Part 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial4.html">Part 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="wiki_tutorial.html">Wiki</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="application_creation.html">Application creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="presentation.html">Presentation service</a></li>
<li class="toctree-l1"><a class="reference internal" href="components.html">Components model</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="callbacks_forms.html">Callbacks and forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="renderer.html">Renderers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Significative URLs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#principle">Principle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-url">1. Adding URL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#components-initialization">2. Components initialization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#components-composition">Components composition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">1. Adding URL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">2. Components initialization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#restful-url">RESTful URL</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wsgiapp.html">WSGI Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="i18n.html">Internationalization and localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="log.html">Log service</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_references.html">Object references</a></li>
<li class="toctree-l1"><a class="reference internal" href="entry_points.html">Entry points</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="demo_installation.html">Demo installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_upgrade.html">Demo upgrade</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nagare</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Significative “RESTful” URLs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="significative-restful-urls">
<h1>Significative “RESTful” URLs<a class="headerlink" href="#significative-restful-urls" title="Permalink to this headline">¶</a></h1>
<p>Nagare doesn’t force you to explicitly map URLs to controllers. With Nagare you
can develop your application and run it without them and, afterwards, set
significative URL only for the resources you want to be able to bookmark.</p>
<div class="section" id="principle">
<h2>Principle<a class="headerlink" href="#principle" title="Permalink to this headline">¶</a></h2>
<p>An URL representes a well-defined state of the application components. The mapping
of significative URL to the components state (the URL scheme) is made in 2 steps:</p>
<ol class="arabic simple">
<li>Give an URL to pages (i.e a components state)</li>
<li>When an URL is received, initialize the components state from it</li>
</ol>
<p>To illustrate these steps, we will use a timezone-aware clock example. First,
install the require <code class="docutils literal"><span class="pre">pytz</span></code> python module:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>&lt;NAGARE_HOME&gt;/bin/easy_install pytz
</pre></div>
</div>
<p>Then we can define our <code class="docutils literal"><span class="pre">Clock</span></code> component with two associated views, the default
view which displays the local time and a view called <code class="docutils literal"><span class="pre">timezone</span></code> to display
its timezone offset:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="kn">import</span> <span class="nn">datetime</span>
 <span class="kn">import</span> <span class="nn">pytz</span>
 <span class="kn">from</span> <span class="nn">nagare</span> <span class="kn">import</span> <span class="n">presentation</span><span class="p">,</span> <span class="n">component</span>

 <span class="k">class</span> <span class="nc">Clock</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
     <span class="c1"># A ``Clock`` object is initialized with a timezone name</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timezone</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">timezone</span><span class="p">)</span> <span class="c1"># Create a timezone object</span>


 <span class="c1"># The default view of a ``Clock`` object displays the local time</span>
 <span class="nd">@presentation.render_for</span><span class="p">(</span><span class="n">Clock</span><span class="p">)</span>
 <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
     <span class="c1"># Retrieve the current UTC time, convert it to local time and display it</span>
     <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
     <span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;font-size: 150%&#39;</span><span class="p">)</span>

     <span class="c1"># When the ``Time Zone`` link is clicked, change to the ``timezone`` view of this object</span>
     <span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">a</span><span class="p">(</span><span class="s1">&#39;Time Zone&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">becomes</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;timezone&#39;</span><span class="p">)</span>

     <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">root</span>

 <span class="c1"># The ``timezone`` view of a ``Clock`` object displays its timezone offset</span>
 <span class="nd">@presentation.render_for</span><span class="p">(</span><span class="n">Clock</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;timezone&#39;</span><span class="p">)</span>
 <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
     <span class="c1"># Retrieve the current UTC time, convert it to local time and display its timezone</span>
     <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
     <span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%z %Z&#39;</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;font-size: 150%&#39;</span><span class="p">)</span>

     <span class="c1"># When the ``Time`` link is clicked, change back to the default view of this object</span>
     <span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">a</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">becomes</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

     <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">root</span>
</pre></div>
</td></tr></table></div>
<p>To test this component, we define a factory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test1</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Clock</span><span class="p">(</span><span class="s1">&#39;America/New_York&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and then launch it with:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>&lt;NAGARE_HOME&gt;/bin/nagare-admin module-serve clock.py:test1 test1
</pre></div>
</div>
<p>Browsing to <a class="reference external" href="http://localhost:8080/test1">http://localhost:8080/test1</a> gives:</p>
<div class="htmlscreen"><div style="font-size: 150%">08:15</div>
<a href="?_s=6428714020224300&amp;_c=00014&amp;_action414144870">Time Zone</a></div><p>and after a click on the <code class="docutils literal"><span class="pre">Time</span> <span class="pre">Zone</span></code> link:</p>
<div class="htmlscreen"><div style="font-size: 150%">-0400 EDT</div>
<a href="?_s=6428714020224300&amp;_c=00015&amp;_action465356083">Time</a></div><p>The <code class="docutils literal"><span class="pre">Clock</span></code> component was developped in straight pure Python, without thinking
about a URL scheme. You can see that switching between the <code class="docutils literal"><span class="pre">Time</span> <span class="pre">Zone</span></code> and
<code class="docutils literal"><span class="pre">Time</span></code> views don’t change the URL path <a class="reference external" href="http://localhost:8080/test1/">http://localhost:8080/test1/</a>.</p>
<div class="section" id="adding-url">
<h3>1. Adding URL<a class="headerlink" href="#adding-url" title="Permalink to this headline">¶</a></h3>
<p>It’s easy to change the URL path when a link is clicked. Just add a normal relative
<code class="docutils literal"><span class="pre">href</span></code> attribut to the link definition.</p>
<p>In our example, we modify the lines #19 and #31:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="c1"># When the ``Time zone`` link is clicked, change to the ``timezone`` view of this object</span>
<span class="hll"><span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">a</span><span class="p">(</span><span class="s1">&#39;Time Zone&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;timezone&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">becomes</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;timezone&#39;</span><span class="p">)</span>
</span><span class="o">...</span>

<span class="o">...</span>
<span class="c1"># When the ``Time`` link is clicked, change back to the default view of this object</span>
<span class="hll"><span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">a</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">becomes</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</span>    <span class="o">...</span>
</pre></div>
</div>
<p>Now, when you click on the links, the URL path is changed to
<a class="reference external" href="http://localhost:8080/test1/time">http://localhost:8080/test1/time</a> or <a class="reference external" href="http://localhost:8080/test1/timezone">http://localhost:8080/test1/timezone</a>.</p>
<p>But if you directly enter the URL <code class="docutils literal"><span class="pre">http://localhost:8080/test1/timezone</span></code> in your
browser, the default view if displayed, not the <code class="docutils literal"><span class="pre">timezone</span></code> one. The following
chapter describes how to initialize the components state with the received URL.</p>
</div>
<div class="section" id="components-initialization">
<h3>2. Components initialization<a class="headerlink" href="#components-initialization" title="Permalink to this headline">¶</a></h3>
<p>When an URL is received, without a session and a continuation parameters or when
the session is expired, Nagare tries to initialized the application components
from the URL path by calling the generic method <code class="docutils literal"><span class="pre">presentation.init_for()</span></code> on
the application root component, with the parameters:</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">self</span></code> – the root object</li>
<li><code class="docutils literal"><span class="pre">url</span></code> – a tuple of the unicode parts of the URL path (starting after the application name)</li>
<li><code class="docutils literal"><span class="pre">comp</span></code> – the component wrapping the root object</li>
<li><code class="docutils literal"><span class="pre">http_method</span></code> – the HTTP method (<code class="docutils literal"><span class="pre">GET</span></code>, <code class="docutils literal"><span class="pre">POST</span></code>, <code class="docutils literal"><span class="pre">PUT</span></code> …)</li>
<li><code class="docutils literal"><span class="pre">request</span></code> – the HTTP <a class="reference external" href="https://webob.readthedocs.io/en/stable/reference.html#request">request</a></li>
</ol>
<p>It’s up to the developper to implement the generic methods to initialize the
root component.</p>
<p>A <code class="docutils literal"><span class="pre">presentation.HTTPNotFound()</span></code> exception can be raised to
send a <code class="docutils literal"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></code> result to the client.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>If no generic method matches, Nagare automatically raises the
<code class="docutils literal"><span class="pre">presentation.HTTPNotFound()</span></code> exception</li>
<li>Any <code class="docutils literal"><span class="pre">webob.exc</span></code> exception can also be raised (<code class="docutils literal"><span class="pre">HTTPMethodNotAllowed</span></code>,
<code class="docutils literal"><span class="pre">HTTPForbidden</span></code> …)</li>
</ul>
</div>
<p>In our example, we implement 2 conditions:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># If no URL is given or url is &#39;time&#39;, set the default view</span>
<span class="nd">@presentation.init_for</span><span class="p">(</span><span class="n">Clock</span><span class="p">,</span> <span class="s1">&#39;not url or url == (u&quot;time&quot;,)&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">http_method</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">becomes</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="c1"># If the url is &#39;timezone&#39;, set the ``timezone`` view</span>
<span class="nd">@presentation.init_for</span><span class="p">(</span><span class="n">Clock</span><span class="p">,</span> <span class="s1">&#39;url == (u&quot;timezone&quot;,)&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">http_method</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">becomes</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;timezone&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note these 2 methods do the exact same actions than when the links are manually
clicked.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you want to set the state of a component as if it was called, don’t directly
do:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">comp</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</pre></div>
</div>
<p>but use the <code class="docutils literal"><span class="pre">component.call_wrapper()</span></code> function:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nagare</span> <span class="kn">import</span> <span class="n">component</span>

<span class="n">component</span><span class="o">.</span><span class="n">call_wrapper</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">comp</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>You can now directly enter the <code class="docutils literal"><span class="pre">http://localhost:8080/test1/time</span></code> or
<code class="docutils literal"><span class="pre">http://localhost:8080/test1/timezone</span></code> URL. Of course, you can also bookmark
them, send them in an email …</p>
</div>
</div>
<div class="section" id="components-composition">
<h2>Components composition<a class="headerlink" href="#components-composition" title="Permalink to this headline">¶</a></h2>
<p>The example is now enhanced with a <code class="docutils literal"><span class="pre">Clocks</span></code> component that can display several
<code class="docutils literal"><span class="pre">Clock</span></code> components:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">Clocks</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
     <span class="c1"># A ``Clocks`` has several ``Clock`` objects and a ``content`` component</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="c1"># The ``Clock`` objects, each associated to a city name</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">cities</span> <span class="o">=</span> <span class="p">{</span>
             <span class="s1">&#39;New-York&#39;</span><span class="p">:</span> <span class="n">Clock</span><span class="p">(</span><span class="s1">&#39;America/New_York&#39;</span><span class="p">),</span>
             <span class="s1">&#39;Paris&#39;</span><span class="p">:</span> <span class="n">Clock</span><span class="p">(</span><span class="s1">&#39;Europe/Paris&#39;</span><span class="p">),</span>
             <span class="s1">&#39;Sydney&#39;</span><span class="p">:</span> <span class="n">Clock</span><span class="p">(</span><span class="s1">&#39;Australia/Sydney&#39;</span><span class="p">)</span>
         <span class="p">}</span>

         <span class="c1"># The ``content`` component, when created, wraps the ``None`` object</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

         <span class="c1"># The ``change_city()`` method change the ``content`` component to</span>
         <span class="c1"># the ``Clock`` object of the city</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">change_city</span><span class="p">(</span><span class="s1">&#39;New-York&#39;</span><span class="p">)</span>

     <span class="k">def</span> <span class="nf">change_city</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
         <span class="c1"># The ``content`` component now wraps an other ``Clock`` object,</span>
         <span class="c1"># which will be rendered with its default view</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">becomes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>


 <span class="c1"># The default view of the ``Clocks`` objects</span>
 <span class="nd">@presentation.render_for</span><span class="p">(</span><span class="n">Clocks</span><span class="p">)</span>
 <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
     <span class="c1"># A bit of CSS to display a tabbed panel</span>
     <span class="n">h</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;clocks_css&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">         .clocks { display: inline-block }</span>
<span class="s1">         .clocks .tab { padding: 0 5px 0 5px; border: 1px solid gray; background-color: #aaa }</span>
<span class="s1">         .clocks .selected_tab { padding-top: 5px; border-bottom: none; background-color: #eee }</span>
<span class="s1">         .clocks .content { border: 1px solid gray; border-top: none; background-color: #eee; text-align: center; padding: 10px }</span>
<span class="s1">     &#39;&#39;&#39;</span><span class="p">)</span>

     <span class="k">with</span> <span class="n">h</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;clocks&#39;</span><span class="p">):</span>
         <span class="c1"># Display all the city names</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">city</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
             <span class="k">if</span> <span class="n">city</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">():</span>  <span class="c1"># ``self.content()`` returns the current wrapped object</span>
                 <span class="c1"># The selected city name is no more clickable</span>
                 <span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;tab selected_tab&#39;</span><span class="p">)</span>
             <span class="k">else</span><span class="p">:</span>
                 <span class="c1"># The others city names, when clicked, invoke the ``change_city()`` method</span>
                 <span class="n">link</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">a</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_city</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                 <span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;tab&#39;</span><span class="p">)</span>

         <span class="c1"># Delegate the rendering to the ``content`` component</span>
         <span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>

     <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">root</span>
</pre></div>
</td></tr></table></div>
<p>Once again, this component is developed without taking care about the URL management
and can be launched with:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>&lt;NAGARE_HOME&gt;/bin/nagare-admin module-serve clock.py:Clocks test2
</pre></div>
</div>
<p>Browsing to <a class="reference external" href="http://localhost:8080/test2">http://localhost:8080/test2</a> gives:</p>
<div class="htmlscreen"><style type="text/css">
        .clocks { display: inline-block }
        .clocks .tab { padding: 0 5px 0 5px; border: 1px solid gray; background-color: #aaa }
        .clocks .selected_tab { padding-top: 5px; border-bottom: none; background-color: #eee }
        .clocks .content { border: 1px solid gray; border-top: none; background-color: #eee; text-align: center; padding: 10px }
    </style>
<link href="/test/New-York" rel="canonical">
</head>
<body><span class="clocks"><span class="tab selected_tab">New-York</span><span class="tab"><a href="/test/Paris?_s=7058172496804938&amp;_c=00005&amp;_action415566362">Paris</a></span><span class="tab"><a href="/test/Sydney?_s=7058172496804938&amp;_c=00005&amp;_action434466943">Sydney</a></span><div class="content">
<div style="font-size: 150%">08:15</div>
<a href="?_s=7058172496804938&amp;_c=00005&amp;_action452866309">Time Zone</a>
</div></span></div><p>and the navigation between the tabs and the time/timezone views is totally
operational:</p>
<div class="htmlscreen"><style type="text/css">
        .clocks { display: inline-block }
        .clocks .tab { padding: 0 5px 0 5px; border: 1px solid gray; background-color: #aaa }
        .clocks .selected_tab { padding-top: 5px; border-bottom: none; background-color: #eee }
        .clocks .content { border: 1px solid gray; border-top: none; background-color: #eee; text-align: center; padding: 10px }
    </style>
<link href="/test/Paris" rel="canonical">
</head>
<body><span class="clocks"><span class="tab"><a href="/test/New-York?_s=7058172496804938&amp;_c=00007&amp;_action417751206">New-York</a></span><span class="tab selected_tab">Paris</span><span class="tab"><a href="/test/Sydney?_s=7058172496804938&amp;_c=00007&amp;_action422642801">Sydney</a></span><div class="content">
<div style="font-size: 150%">+0200 CEST</div>
<a href="?_s=7058172496804938&amp;_c=00007&amp;_action435022084">Time</a>
</div></span></div><div class="section" id="id1">
<h3>1. Adding URL<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>A Nagare application is made of a dynamic tree of components. A parent component
can fix the URL prefix their children will use for their links, by using the <code class="docutils literal"><span class="pre">url</span></code>
parameter of:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">component.Component(o,</span> <span class="pre">url='...')</span></code></li>
<li><code class="docutils literal"><span class="pre">comp.becomes(o,</span> <span class="pre">url='...')</span></code></li>
<li><code class="docutils literal"><span class="pre">comp.call(o,</span> <span class="pre">url='...')</span></code></li>
</ul>
<p>In our example, we decide that the URL of the links generated by the <code class="docutils literal"><span class="pre">Clock</span></code>
views will began by the name of the city. So we add the parameter <code class="docutils literal"><span class="pre">url=&lt;city</span> <span class="pre">name&gt;</span></code>
line #21 and <code class="docutils literal"><span class="pre">href=&lt;city_name&gt;</span></code> line #43:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">change_city</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">becomes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span>    <span class="o">...</span>

    <span class="o">...</span>
    <span class="c1"># The others city names, when clicked, invoke the ``change_city()`` method</span>
<span class="hll">    <span class="n">link</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">a</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_city</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span>    <span class="o">...</span>
</pre></div>
</div>
<p>Now, the URL path changes to <a class="reference external" href="http://localhost:8080/test2/Paris/time">http://localhost:8080/test2/Paris/time</a> or
<a class="reference external" href="http://localhost:8080/test2/Sydney/timezone">http://localhost:8080/test2/Sydney/timezone</a> … Where the first part (<code class="docutils literal"><span class="pre">Paris</span></code>,
<code class="docutils literal"><span class="pre">Sydney</span></code> …) is set by the <code class="docutils literal"><span class="pre">Clocks</span></code> component and the last part (<code class="docutils literal"><span class="pre">time</span></code>
or <code class="docutils literal"><span class="pre">timezone</span></code>) is set by the <code class="docutils literal"><span class="pre">Clock</span></code> component.</p>
</div>
<div class="section" id="id2">
<h3>2. Components initialization<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>First a parent component initializes itself with parts of the received URL. Then
it delegates the initialization to their children by calling their <code class="docutils literal"><span class="pre">init()</span></code>
method with the parameters:</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">url</span></code> – the rest of the URL parts</li>
<li><code class="docutils literal"><span class="pre">http_method</span></code> – the HTTP method (<code class="docutils literal"><span class="pre">GET</span></code>, <code class="docutils literal"><span class="pre">POST</span></code>, <code class="docutils literal"><span class="pre">PUT</span></code> …)</li>
<li><code class="docutils literal"><span class="pre">request</span></code> – the HTTP <a class="reference external" href="https://webob.readthedocs.io/en/stable/reference.html#request">request</a></li>
</ol>
<p>So, we add a <code class="docutils literal"><span class="pre">presentation.init_for()</span></code> implementation for the <code class="docutils literal"><span class="pre">Clocks</span></code>
component that uses the first part of the URL (the city name) to initialize
itself. Then we delegate the finalisation of the initialization to the <code class="docutils literal"><span class="pre">content</span></code>
component, passing it the rest of the URL:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@presentation.init_for</span><span class="p">(</span><span class="n">Clocks</span><span class="p">,</span> <span class="s1">&#39;len(url) &gt;= 1&#39;</span><span class="p">)</span> <span class="c1"># The url must have at least 1 part</span>
<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">http_method</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># The first part of the url is the city name</span>
    <span class="k">if</span> <span class="n">city</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="p">:</span> <span class="c1"># Check if the city name is valid</span>
        <span class="k">raise</span> <span class="n">presentation</span><span class="o">.</span><span class="n">HTTPNotFound</span><span class="p">()</span> <span class="c1"># Else, send back a ``404``</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">change_city</span><span class="p">(</span><span class="n">city</span><span class="p">)</span>  <span class="c1"># Set the ``content`` component</span>

    <span class="c1"># The ``content`` component is initialized with the rest of the URL</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">http_method</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="restful-url">
<h2>RESTful URL<a class="headerlink" href="#restful-url" title="Permalink to this headline">¶</a></h2>
<p>You may have noticed the <code class="docutils literal"><span class="pre">presentation.init_for()</span></code> also received the <code class="docutils literal"><span class="pre">http_method</span></code>
parameter (typically <code class="docutils literal"><span class="pre">GET</span></code>, <code class="docutils literal"><span class="pre">POST</span></code>, <code class="docutils literal"><span class="pre">PUT</span></code> and <code class="docutils literal"><span class="pre">DELETE</span></code>) and the full
<a class="reference external" href="https://webob.readthedocs.io/en/stable/reference.html#request">request</a> object.
In true RESTful style, both these parameters can be used to initialized the
components tree.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The HTTP method can also be sent by the client though the <code class="docutils literal"><span class="pre">_method</span></code> parameter,
using GET or POST requests.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="wsgiapp.html" class="btn btn-neutral float-right" title="The WSGI Application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="renderer.html" class="btn btn-neutral" title="The Renderer objects" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.4.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
   

</body>
</html>