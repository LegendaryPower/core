

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Nagare Tutorial, learning concepts &mdash; Nagare 0.5.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Nagare 0.5.1 documentation" href="index.html"/>
        <link rel="next" title="Nagare Tutorial, learning concepts" href="tutorial3.html"/>
        <link rel="prev" title="Nagare Tutorial, learning concepts" href="tutorial1.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="description.html">Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">Using it</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">QuickStart</a></li>
<li class="toctree-l1"><a class="reference internal" href="framework_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="framework_upgrade.html">Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="nagare-admin.html">nagare-admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_file.html">Application configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="publisher_file.html">Publisher configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Application deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="third_party.html">Third party applications</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial1.html">Part 1</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Part 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#part-2-modify-the-default-application">Part 2. Modify the default application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial3.html">Part 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial4.html">Part 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="wiki_tutorial.html">Wiki</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="application_creation.html">Application creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="presentation.html">Presentation service</a></li>
<li class="toctree-l1"><a class="reference internal" href="components.html">Components model</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="callbacks_forms.html">Callbacks and forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="renderer.html">Renderers</a></li>
<li class="toctree-l1"><a class="reference internal" href="restful.html">Significative URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="wsgiapp.html">WSGI Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="i18n.html">Internationalization and localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="log.html">Log service</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_references.html">Object references</a></li>
<li class="toctree-l1"><a class="reference internal" href="entry_points.html">Entry points</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="demo_installation.html">Demo installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_upgrade.html">Demo upgrade</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nagare</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Nagare Tutorial, learning concepts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="nagare-tutorial-learning-concepts">
<h1>Nagare Tutorial, learning concepts<a class="headerlink" href="#nagare-tutorial-learning-concepts" title="Permalink to this headline">¶</a></h1>
<p>The main goal of Nagare is to develop a web application like any standard python application. There are three steps to reach this goal:</p>
<ul class="simple">
<li>Do everything in python (no sql, no templating language, avoid hand-written javascript as much as possible)</li>
<li>Hide the request/response connectionless nature of HTTP: no manual handling of the session</li>
<li>Use aggregation as the shortest way to transform any python object into a Nagare component</li>
</ul>
<div class="section" id="part-2-modify-the-default-application">
<h2>Part 2. Modify the default application<a class="headerlink" href="#part-2-modify-the-default-application" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">With <code class="docutils literal notranslate"><span class="pre">nagare-admin</span> <span class="pre">create-app</span></code> a complete <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> compatible package is created.
Some Nagare specific files are also created:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">conf/tutorial.cfg</span></code>: application configuration file</li>
<li><code class="docutils literal notranslate"><span class="pre">data</span></code>: folder where read/write datas are expected (sqlite database, csv files, etc.)</li>
<li><code class="docutils literal notranslate"><span class="pre">static</span></code>: folder where html static files are stored (css, images and javascripts)</li>
<li><code class="docutils literal notranslate"><span class="pre">tutorial/models.py</span></code>: module where the database models are defined using Elixir/SQLAlchemy ORM</li>
<li><code class="docutils literal notranslate"><span class="pre">tutorial/app.py</span></code>: code of your application</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Let’s start with a pure python class. Replace the whole content of <code class="docutils literal notranslate"><span class="pre">tutorial/app.py</span></code> with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">increase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">decrease</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p class="first">Now, add an HTML view for the <code class="docutils literal notranslate"><span class="pre">Counter</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nagare</span> <span class="kn">import</span> <span class="n">presentation</span>
<span class="o">...</span>
<span class="nd">@presentation.render_for</span><span class="p">(</span><span class="n">Counter</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;Hello&#39;</span>
</pre></div>
</div>
<p>For Nagare, a view is just a function that takes the object to render and a renderer (<code class="docutils literal notranslate"><span class="pre">h</span></code>)
as parameters and returns a DOM tree. In this example, we return a simple DOM tree with
only a single text node. To bind the view to the <code class="docutils literal notranslate"><span class="pre">Counter</span></code> class, we import the Nagare
presentation service and use the <code class="docutils literal notranslate"><span class="pre">render_for</span></code> decorator.</p>
</li>
<li><p class="first">Define the Nagare application:</p>
<p>For Nagare, an application is just an object factory (i.e. a callable that returns an objects graph),
and obviously a class is, so we just have to add the following to our <code class="docutils literal notranslate"><span class="pre">app.py</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="c1"># define app</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Counter</span>
</pre></div>
</div>
</li>
<li><p class="first">You can now view your new web application in your browser (go to <a class="reference external" href="http://localhost:8080/tutorial">http://localhost:8080/tutorial</a>).</p>
</li>
</ol>
<p>If you take a look at the page source, you could see that Nagare has wrapped the text node into a valid html structure. By default, the DOM tree is serialized as HTML4. This can be changed in the application configuration file, to use XHTML if the browser accepts it or HTML5.</p>
<ol class="arabic" start="6">
<li><p class="first">A more complex DOM tree:</p>
<p>Replace the <code class="docutils literal notranslate"><span class="pre">Counter</span></code> view with the following one:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="nd">@presentation.render_for</span><span class="p">(</span><span class="n">Counter</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="s1">&#39;Value: &#39;</span><span class="p">,</span> <span class="n">counter</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>As you can see the <code class="docutils literal notranslate"><span class="pre">h</span></code> HTML renderer can be used as a factory for all the HTML tags.</p>
<p>As we build a server-side DOM tree, we are protected against code injection. For example, if <code class="docutils literal notranslate"><span class="pre">counter.val</span></code> contains something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;&lt;script&gt;alert(&#39;Hello World&#39;);&lt;/script&gt;&quot;</span>
</pre></div>
</div>
<p>This string would be escaped and no javascript will ever be executed.</p>
</li>
</ol>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial3.html" class="btn btn-neutral float-right" title="Nagare Tutorial, learning concepts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial1.html" class="btn btn-neutral" title="Nagare Tutorial, learning concepts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.5.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
   

</body>
</html>