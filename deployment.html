

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Deploying Nagare applications in a production environment &mdash; Nagare 0.4.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Nagare 0.4.1 documentation" href="index.html"/>
        <link rel="next" title="Installing a third party application" href="third_party.html"/>
        <link rel="prev" title="The publisher configuration file" href="publisher_file.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="description.html">Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">Using it</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">QuickStart</a></li>
<li class="toctree-l1"><a class="reference internal" href="framework_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="framework_upgrade.html">Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="nagare-admin.html">nagare-admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_file.html">Application configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="publisher_file.html">Publisher configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Application deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#serving-an-application-through-fastcgi">Serving an application through FastCGI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-publisher-configuration">The publisher configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-web-server">Configuring the Web server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#apache">Apache</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nginx">Nginx</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lighttpd">Lighttpd</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#handling-the-fastcgi-processes">Handling the FastCGI processes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="third_party.html">Third party applications</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial1.html">Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial2.html">Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial3.html">Part 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial4.html">Part 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="wiki_tutorial.html">Wiki</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="application_creation.html">Application creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="presentation.html">Presentation service</a></li>
<li class="toctree-l1"><a class="reference internal" href="components.html">Components model</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="callbacks_forms.html">Callbacks and forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="renderer.html">Renderers</a></li>
<li class="toctree-l1"><a class="reference internal" href="restful.html">Significative URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="wsgiapp.html">WSGI Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="i18n.html">Internationalization and localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="log.html">Log service</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_references.html">Object references</a></li>
<li class="toctree-l1"><a class="reference internal" href="entry_points.html">Entry points</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="demo_installation.html">Demo installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_upgrade.html">Demo upgrade</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nagare</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Deploying Nagare applications in a production environment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="deploying-nagare-applications-in-a-production-environment">
<h1>Deploying Nagare applications in a production environment<a class="headerlink" href="#deploying-nagare-applications-in-a-production-environment" title="Permalink to this headline">¶</a></h1>
<p>Serving a Nagare application in a development setup is easy. You just have to launch
the following command:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>nagare-admin serve <span class="o">[</span>options<span class="o">]</span> &lt;app_name&gt;
</pre></div>
</div>
<p>It starts a standalone threaded server which stores the sessions data in memory.</p>
<p>This standalone server is very convenient when developing Nagare applications, especially when
using the <code class="docutils literal"><span class="pre">--reload</span></code> and <code class="docutils literal"><span class="pre">--debug</span></code> options that respectively restart the server when source
files are changed and show the exceptions stacktraces as Web pages instead of in the console
shell.</p>
<p>However, this standalone mode is not suitable in a production environment, because it is not
efficient nor fail-safe:</p>
<ul class="simple">
<li>Since it’s a threaded program, it does not fully utilize the CPU cores due to the GIL (see <a class="reference external" href="http://stackoverflow.com/questions/4496680/python-threads-all-executing-on-a-single-core">this
discussion</a>).
To solve this problem, we need to use multiprocessing.</li>
<li>Static files are served by the standalone server and are not cached. They would be better served
by a faster dedicated Web server such as Apache, Nginx, Lighttpd …</li>
<li>The server processes are not monitored, and they don’t cope with failures very well. For example, in a
production setup, it’s important to detect zombie processes and restart them to prevent attacks or to limit
the impact of unnoticed programmation errors in the application. Of course, you should also use logging
to trace the origin of the problems in order to solve them.</li>
</ul>
<p>So, in a production environment, the recommended way to serve Nagare applications
is through <em>FastCGI</em> associated to a frontend Web server such as Apache, Nginx or
Lighttpd.  We are now going to describe how to do that.</p>
<div class="section" id="serving-an-application-through-fastcgi">
<h2>Serving an application through FastCGI<a class="headerlink" href="#serving-an-application-through-fastcgi" title="Permalink to this headline">¶</a></h2>
<p>In a FastCGI setup, a Web server such as <a class="reference external" href="http://httpd.apache.org/">Apache</a>, <a class="reference external" href="http://nginx.org/">Nginx</a> or <a class="reference external" href="http://www.lighttpd.net/">Lighttpd</a> is needed. It will serve
the static contents of the application, such as images, CSS and javascript files, and pass the other requests
(i.e. those with a “dynamic” nature) to the Nagare application through the <a class="reference external" href="https://fastcgi-archives.github.io">FastCGI</a> protocol.</p>
<p>FastCGI is a variation of the CGI protocol, which defines an interface layer between a Web server and external
applications (such as shell or python scripts). The main difference between FastCGI and CGI is that FastCGI
doesn’t create a new worker process at the start of each request but use a pool of processes that are created
when the FastCGI service starts, and uses sockets for exchanging informations (i.e. request and response data)
between the Web server and the external applications.</p>
<p>This setup is particularly efficient when serving Nagare applications because
the pool of processes fully utilize the CPU cores. Furthermore, Web servers are
far more efficient than the standalone threaded server when serving the static
contents of the application since they cache the data and they are mostly written
in C.</p>
<div class="section" id="the-publisher-configuration">
<h3>The publisher configuration<a class="headerlink" href="#the-publisher-configuration" title="Permalink to this headline">¶</a></h3>
<p>In order to serve a Nagare application through FastCGI, we must first tell the <code class="docutils literal"><span class="pre">nagare-admin</span> <span class="pre">serve</span></code> utility
that we don’t want to use the standalone server but FastCGI instead. This is done by creating a publisher
configuration file (see <a class="reference internal" href="publisher_file.html"><span class="doc">The publisher configuration file</span></a>) and passing it to the <code class="docutils literal"><span class="pre">nagare-admin</span> <span class="pre">serve</span></code> command
with the <code class="docutils literal"><span class="pre">-c</span></code> option.</p>
<p>Here is a typical publisher configuration file to serve an application through FastCGI:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[publisher]</span>
<span class="na">type</span> <span class="o">=</span> <span class="s">fastcgi</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">9000</span>

<span class="k">[sessions]</span>
<span class="na">type</span> <span class="o">=</span> <span class="s">memcache</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">11211</span>
</pre></div>
</div>
<p>We use the <code class="docutils literal"><span class="pre">fastcgi</span></code> backend for the publisher (with the default settings) and the <code class="docutils literal"><span class="pre">memcache</span></code> backend for
the sessions management.</p>
<p>Then, the FastCGI server can be launched by running this command:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>nagare-admin serve -c publisher.conf &lt;app_name&gt;
</pre></div>
</div>
<p>By default, the FastCGI server forks 5 worker processes at startup to handle the incoming requests received on
port 9000. However, the number of worker processes can grow or shrink depending on the workload.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When an application is served through FastCGI, you must use a <code class="docutils literal"><span class="pre">memcache</span></code>
backend for storing the sessions data. The default <code class="docutils literal"><span class="pre">standalone</span></code> session
backend will not work with FastCGI because the session data is stored
in memory, and since the processes spawned by the FastCGI server don’t
share memory (by definition), the sessions data stored in one process would
not be available in another process.</p>
<p class="last">That’s why a kind of distributed “shared memory” session backend should be
used with the FastCGI publisher. So don’t forget to launch your <code class="docutils literal"><span class="pre">memcached</span></code>
server.</p>
</div>
<p>As the sessions are shared through the memcached server, the same FastCGI
application can be launched on several machines thus easily creating a scalable
applicative cluster.</p>
</div>
<div class="section" id="configuring-the-web-server">
<h3>Configuring the Web server<a class="headerlink" href="#configuring-the-web-server" title="Permalink to this headline">¶</a></h3>
<p>The next step is to configure the Web server so that it serves the static files and pass the other requests to the
FastCGI processes we just launched. Of course, the procedure depend on the Web server used, so we are going to
show you how to achieve that with <a class="reference external" href="http://httpd.apache.org/">Apache</a>, <a class="reference external" href="http://nginx.org/">Nginx</a> and <a class="reference external" href="http://www.lighttpd.net/">Lighttpd</a>. However, it should be easy to use another Web
server supporting FastCGI if you want to.</p>
<div class="section" id="apache">
<h4>Apache<a class="headerlink" href="#apache" title="Permalink to this headline">¶</a></h4>
<p>On Apache, the FastCGI support is provided by the <code class="docutils literal"><span class="pre">mod_fastcgi</span></code> module which is not installed by default.
You should download and install it by yourself, as described <a class="reference external" href="http://www.fastcgi.com/mod_fastcgi/INSTALL">here</a>.
Then, the <code class="docutils literal"><span class="pre">mod_fastcgi</span></code> module should be activated by including it in the main apache configuration file as shown
below:</p>
<div class="highlight-apache"><div class="highlight"><pre><span></span><span class="nb">LoadModule</span> fastcgi_module <span class="sx">/path/to/mod_fastcgi.so</span>
</pre></div>
</div>
<p>The rewrite rules serving the static files of your application can be generated with this command:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>nagare-admin create-rules --apache &lt;application&gt; &gt; rewrite_rules.apache
</pre></div>
</div>
<p>You should obtain something like this:</p>
<div class="highlight-apache"><div class="highlight"><pre><span></span><span class="nb">RewriteEngine</span> <span class="k">On</span>
<span class="nb">RewriteRule</span> ^/static/nagare/(.*)$ <span class="sx">/path/to/python/site-packages/nagare-0.4.1-py2.7.egg/static/</span>$1 [L]
<span class="nb">RewriteRule</span> ^/static/myapp/(.*)$ <span class="sx">/path/to/python/site-packages/myapp-0.0.1-py2.7.egg/static/</span>$1 [L]
</pre></div>
</div>
<p>Then, you must create a <code class="docutils literal"><span class="pre">VirtualHost</span></code> for your application and include the rewrite rules file
into the configuration, as shown below:</p>
<div class="highlight-apache"><div class="highlight"><pre><span></span><span class="c"># virtualhost configuration for http://www.myapp.com</span>
<span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> www.myapp.com

    <span class="nb">FastCGIExternalServer</span> <span class="sx">/path/to/python/site-packages/fcgi</span> -host <span class="m">127.0.0.1</span>:9000

    <span class="nb">Include</span> <span class="sx">/path/to/rewrite_rules.apache</span>
    <span class="nb">RewriteRule</span> ^/(.*)$ <span class="sx">/fcgi/</span>$1 [QSA,L]
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">FastCGIExternalServer</span></code> directive instructs Apache to forward the requests directed to
<code class="docutils literal"><span class="pre">/path/to/python/site-packages/fcgi</span></code> to the FastCGI server listening at <code class="docutils literal"><span class="pre">127.0.0.1</span></code> on port
<code class="docutils literal"><span class="pre">9000</span></code> which has been launched externally, and the last <code class="docutils literal"><span class="pre">RewriteRule</span></code> directive redirects
the requests not handled by the other rewrite rules to <code class="docutils literal"><span class="pre">/path/to/python/site-packages/fcgi</span></code>,
thus forwarding those requests to the FastCGI processes.</p>
<p>Finally, you should <code class="docutils literal"><span class="pre">include</span></code> the <code class="docutils literal"><span class="pre">VirtualHost</span></code> configuration file into the main
apache configuration file, or put it in the <code class="docutils literal"><span class="pre">conf.d</span></code> directory of your apache installation,
and restart Apache.</p>
</div>
<div class="section" id="nginx">
<h4>Nginx<a class="headerlink" href="#nginx" title="Permalink to this headline">¶</a></h4>
<p>Nginx has builtin support for FastCGI thanks to the <a class="reference external" href="http://wiki.nginx.org/HttpFastcgiModule">Nginx’s HttpFastcgiModule</a>, so no
manual installation is necessary.</p>
<p>The rewrite rules serving the static files can be generated with this command:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>nagare-admin create-rules --nginx &lt;application&gt; &gt; rewrite_rules.nginx
</pre></div>
</div>
<p>You should obtain something like this:</p>
<div class="highlight-nginx"><div class="highlight"><pre><span></span><span class="k">location</span> <span class="s">/static/nagare/</span> <span class="p">{</span>
  <span class="kn">alias</span> <span class="s">/path/to/python/site-packages/nagare-0.4.1-py2.7.egg/static/</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span> <span class="s">/static/myapp/</span> <span class="p">{</span>
  <span class="kn">alias</span> <span class="s">/path/to/python/site-packages/myapp-0.0.1-py2.7.egg/static/</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, you must create a server configuration, as shown below:</p>
<div class="highlight-nginx"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">www.myapp.com</span><span class="p">;</span>
    <span class="kn">access_log</span> <span class="s">/var/log/nginx/myapp.access.log</span><span class="p">;</span>
    <span class="kn">error_log</span> <span class="s">/var/log/nginx/myapp.error.log</span><span class="p">;</span>

    <span class="c1"># serve the static files</span>
    <span class="kn">include</span> <span class="s">/path/to/rewrite_rules.nginx</span><span class="p">;</span>

    <span class="c1"># serve the application</span>
    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">include</span> <span class="s">/etc/nginx/fastcgi_params</span><span class="p">;</span>
        <span class="c1"># Nagare applications need a properly set PATH_INFO variable</span>
        <span class="c1"># either pass the request URI or use fastcgi_split_path_info to split the URI</span>
        <span class="kn">fastcgi_param</span> <span class="s">PATH_INFO</span> <span class="nv">$fastcgi_script_name</span><span class="p">;</span>
        <span class="kn">fastcgi_pass</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">9000</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that, in addition to the default FastCGI parameters specified in <code class="docutils literal"><span class="pre">/etc/nginx/fastcgi_params</span></code>,
we must also set the <code class="docutils literal"><span class="pre">PATH_INFO</span></code> parameter which is required by Nagare.</p>
<p>Finally, you must copy the configuration file in <code class="docutils literal"><span class="pre">/etc/nginx/conf.d/</span></code>, or create a symbolic link
there pointing to your configuration file, and restart Nginx.</p>
</div>
<div class="section" id="lighttpd">
<h4>Lighttpd<a class="headerlink" href="#lighttpd" title="Permalink to this headline">¶</a></h4>
<p>Lighttpd has also builtin support for FastCGI thanks to the <a class="reference external" href="http://redmine.lighttpd.net/projects/lighttpd/wiki/Docs:ModFastCGI">Lighttpd’s mod_fastcgi</a> module.</p>
<p>The rewrite rules serving the static files can be generated with this command:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>nagare-admin create-rules --lighttpd &lt;application&gt; &gt; rewrite_rules.lighttpd
</pre></div>
</div>
<p>However, it’s easier the generate the rewrite rules in an <code class="docutils literal"><span class="pre">include_shell</span></code> directive.
An example of Lighttpd server configuration is show below:</p>
<div class="highlight-lighttpd"><div class="highlight"><pre><span></span><span class="k">server.modules</span> <span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;mod_rewrite&quot;</span><span class="p">,</span> <span class="s2">&quot;mod_fastcgi&quot;</span> <span class="p">)</span>
<span class="k">server.errorlog</span> <span class="o">=</span> <span class="s2">&quot;/tmp/lighttpd.log&quot;</span>
<span class="k">server.indexfiles</span> <span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;index.html&quot;</span> <span class="p">)</span>

<span class="c1">#debug.log-request-handling = &quot;enable&quot;</span>

<span class="k">server.port</span> <span class="o">=</span> <span class="m">8080</span>
<span class="k">server.bind</span> <span class="o">=</span> <span class="s2">&quot;0.0.0.0&quot;</span>
<span class="c1">#server.event-handler = &quot;linux-sysepoll&quot;</span>

<span class="k">fastcgi.server</span> <span class="o">=</span> <span class="p">(</span>
                 <span class="s2">&quot;/fcgi&quot;</span> <span class="o">=&gt;</span>
                 <span class="p">(</span>
                     <span class="p">(</span>
                         <span class="s2">&quot;host&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;port&quot;</span> <span class="o">=&gt;</span> <span class="m">9000</span><span class="p">,</span>
                         <span class="s2">&quot;check-local&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;disable&quot;</span><span class="p">,</span>
                     <span class="p">)</span>
                 <span class="p">)</span>
             <span class="p">)</span>

<span class="c1"># Here, change the path to the ``nagare-admin`` command</span>
<span class="k">include_shell</span> <span class="s2">&quot;path/to/nagare-admin create-rules --lighttpd&quot;</span>
<span class="k">url.rewrite</span> <span class="o">+=</span> <span class="p">(</span>
    <span class="s2">&quot;^(.*)&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/fcgi/$1&quot;</span>
<span class="p">)</span>

<span class="c1"># ---------------------------------------------------------------------------------</span>

<span class="k">mimetype.assign</span> <span class="o">=</span> <span class="p">(</span>
  <span class="s2">&quot;.pdf&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/pdf&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.sig&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/pgp-signature&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.spl&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/futuresplash&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.class&quot;</span>        <span class="o">=&gt;</span>      <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.ps&quot;</span>           <span class="o">=&gt;</span>      <span class="s2">&quot;application/postscript&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.torrent&quot;</span>      <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-bittorrent&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.dvi&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-dvi&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.gz&quot;</span>           <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-gzip&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.pac&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-ns-proxy-autoconfig&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.swf&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-shockwave-flash&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.tar.gz&quot;</span>       <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-tgz&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.tgz&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-tgz&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.tar&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-tar&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.zip&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/zip&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.mp3&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;audio/mpeg&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.m3u&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;audio/x-mpegurl&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.wma&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;audio/x-ms-wma&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.wax&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;audio/x-ms-wax&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.ogg&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/ogg&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.wav&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;audio/x-wav&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.gif&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;image/gif&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.jpg&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.jpeg&quot;</span>         <span class="o">=&gt;</span>      <span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.png&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;image/png&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.xbm&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;image/x-xbitmap&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.xpm&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;image/x-xpixmap&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.xwd&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;image/x-xwindowdump&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.css&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;text/css&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.html&quot;</span>         <span class="o">=&gt;</span>      <span class="s2">&quot;text/html&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.htm&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;text/html&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.js&quot;</span>           <span class="o">=&gt;</span>      <span class="s2">&quot;text/javascript&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.asc&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.c&quot;</span>            <span class="o">=&gt;</span>      <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.conf&quot;</span>         <span class="o">=&gt;</span>      <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.text&quot;</span>         <span class="o">=&gt;</span>      <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.txt&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.dtd&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;text/xml&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.xml&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;text/xml&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.mpeg&quot;</span>         <span class="o">=&gt;</span>      <span class="s2">&quot;video/mpeg&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.mpg&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;video/mpeg&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.mov&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;video/quicktime&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.qt&quot;</span>           <span class="o">=&gt;</span>      <span class="s2">&quot;video/quicktime&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.avi&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;video/x-msvideo&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.asf&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;video/x-ms-asf&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.asx&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;video/x-ms-asf&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.wmv&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;video/x-ms-wmv&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.bz2&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-bzip&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.tbz&quot;</span>          <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-bzip-compressed-tar&quot;</span><span class="p">,</span>
  <span class="s2">&quot;.tar.bz2&quot;</span>      <span class="o">=&gt;</span>      <span class="s2">&quot;application/x-bzip-compressed-tar&quot;</span>
 <span class="p">)</span>
</pre></div>
</div>
<p>Then, place this config file in <code class="docutils literal"><span class="pre">/etc/lighttpd/lighttpd.conf</span></code> and restart Lighttpd.</p>
</div>
</div>
</div>
<div class="section" id="handling-the-fastcgi-processes">
<h2>Handling the FastCGI processes<a class="headerlink" href="#handling-the-fastcgi-processes" title="Permalink to this headline">¶</a></h2>
<p>Since the FastCGI processes are launched externally from the Web server, you can use any monitoring
tool to handle the processes, such as <a class="reference external" href="http://supervisord.org/">Supervisor</a>. Here is a typical configuration file that starts
a Nagare application as a daemon with Supervisor:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[unix_http_server]</span>
<span class="na">file</span><span class="o">=</span><span class="s">/path/to/supervisord/supervisor.sock</span>

<span class="k">[supervisord]</span>
<span class="na">logfile</span><span class="o">=</span><span class="s">/path/to/supervisord/supervisord.log</span>
<span class="na">pidfile</span><span class="o">=</span><span class="s">/path/to/supervisord/supervisord.pid</span>
<span class="na">directory</span><span class="o">=</span><span class="s">/path/to/supervisord</span>

<span class="k">[rpcinterface:supervisor]</span>
<span class="na">supervisor.rpcinterface_factory</span> <span class="o">=</span> <span class="s">supervisor.rpcinterface:make_main_rpcinterface</span>

<span class="k">[supervisorctl]</span>
<span class="na">serverurl</span><span class="o">=</span><span class="s">unix:///path/to/supervisord/supervisor.sock</span>

<span class="k">[program:myapp]</span>
<span class="na">command</span><span class="o">=</span><span class="s">/path/to/nagare-admin serve /path/to/application/conf/myapp.conf -c /path/to/application/conf/fastcgi.conf</span>
<span class="na">process_name</span><span class="o">=</span><span class="s">myapp</span>
<span class="na">autostart</span><span class="o">=</span><span class="s">true</span>
<span class="na">autorestart</span><span class="o">=</span><span class="s">true</span>
<span class="na">stdout_logfile</span><span class="o">=</span><span class="s">/path/to/application/logs/myapp.log</span>
<span class="na">redirect_stderr</span><span class="o">=</span><span class="s">true</span>
</pre></div>
</div>
<p>Then, you can start the application by running this command:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>/path/to/supervisord -c /path/to/supervisord.conf
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">supervisord</span></code> process daemonizes itself and starts the FastCGI processes through
the <code class="docutils literal"><span class="pre">nagare-admin</span> <span class="pre">serve</span></code> command. Furthermore, they are restarted automatically when something goes
wrong thanks to the <code class="docutils literal"><span class="pre">autorestart</span></code> option.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="third_party.html" class="btn btn-neutral float-right" title="Installing a third party application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="publisher_file.html" class="btn btn-neutral" title="The publisher configuration file" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.4.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
   

</body>
</html>